<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-rollkit-stack">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">The Rollkit stack | Rollkit</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://rollkit.dev/img/Rollkit-og.png"><meta data-rh="true" name="twitter:image" content="https://rollkit.dev/img/Rollkit-og.png"><meta data-rh="true" property="og:url" content="https://rollkit.dev/docs/rollkit-stack/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="The Rollkit stack | Rollkit"><meta data-rh="true" name="description" content="Intro to Rollkit&#x27;s stack, a modular framework for rollups."><meta data-rh="true" property="og:description" content="Intro to Rollkit&#x27;s stack, a modular framework for rollups."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://rollkit.dev/docs/rollkit-stack/"><link data-rh="true" rel="alternate" href="https://rollkit.dev/docs/rollkit-stack/" hreflang="en"><link data-rh="true" rel="alternate" href="https://rollkit.dev/docs/rollkit-stack/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Rollkit RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Rollkit Atom Feed">



<script src="https://plausible.celestia.org/js/plausible.js" defer="defer" data-domain="rollkit.dev"></script><link rel="stylesheet" href="/assets/css/styles.de5edbda.css">
<link rel="preload" href="/assets/js/runtime~main.5469df33.js" as="script">
<link rel="preload" href="/assets/js/main.532514d8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/rollkit-blk.svg" alt="Rollkit" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/rollkit-wht.svg" alt="Rollkit" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docs/intro/">Docs</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog/">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://t.me/rollkit" target="_blank" rel="noopener noreferrer" class="dropdown__link">Telegram<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://twitter.com/Rollkitdev" target="_blank" rel="noopener noreferrer" class="dropdown__link">Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://calendar.google.com/calendar/u/0/r?cid=c_11a8d6a470ca9c07b131ab1ea213ac124a3061a9d6986bb208d88afbcc4bb3d2@group.calendar.google.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">Google Calendar<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.youtube.com/@RollkitDev" target="_blank" rel="noopener noreferrer" class="dropdown__link">YouTube<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/rollkit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/rollkit-stack/">Rollkit stack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/transaction-flow/">Transaction flow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/category/tutorials/">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/docs/category/beginner/">Beginner</a><button aria-label="Toggle the collapsible sidebar category &#x27;Beginner&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/building-and-deploying-a-rollup/">Building &amp; deploying a rollup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/gm-world/">GM world tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/recipe-book/">Recipe book tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/restart-rollkit-rollup/">How to restart your rollup</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/docs/category/intermediate/">Intermediate</a><button aria-label="Toggle the collapsible sidebar category &#x27;Intermediate&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/wordle/">Wordle tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/cosmwasm/">CosmWasm tutorial</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/docs/category/advanced/">Advanced</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/ethermint/">Ethermint (EVM) tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a href="https://docs.celestia.org/developers/full-stack-modular-development-guide" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Full-stack modular dapp with Celestia<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a href="https://docs.hyperlane.xyz/docs/deploy/celestia-+-hyperlane" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Hyperlane + Celestia tutorial<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Rollkit stack</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>The Rollkit stack</h1><p>This page will cover the main components of Rollkit.</p><p>Rollup sequencer nodes collect transactions from users, aggregate them into blocks, and post the blocks onto a data availability (DA) layer (such as Celestia) to be ordered and finalized. Full nodes execute and verify rollup blocks, and in the case of an optimistic rollup, propagate fraud proofs when needed. Light clients will receive headers, verify proofs (fraud, zk, etc), and authenticate trust-minimized queries about the state.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Tip</div><div class="admonitionContent_S0QG"><p>If you&#x27;re familiar with Rollkit&#x27;s stack, you may want to skip to the <a href="/docs/category/tutorials/">tutorials section</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="application-structure">Application structure<a class="hash-link" href="#application-structure" title="Direct link to heading">‚Äã</a></h2><p><img loading="lazy" alt="Rollup architecture with Rollkit and ABCI." src="/assets/images/rollkit-abci-75320e3e62c47f3eeebc5b90dd5d01d0.png" width="1538" height="1127" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="abci-interface">ABCI interface<a class="hash-link" href="#abci-interface" title="Direct link to heading">‚Äã</a></h3><p>Rollkit is a fully functional Application BlockChain Interface (ABCI) client software. It can be used as a Tendermint replacement for any ABCI application.
Thanks to this compatibility, you can use tools like <a href="https://docs.tendermint.com/v0.34/app-dev/abci-cli.html" target="_blank" rel="noopener noreferrer">abci-cli</a> to test and debug your rollup.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cosmos-sdk">Cosmos SDK<a class="hash-link" href="#cosmos-sdk" title="Direct link to heading">‚Äã</a></h4><p>Would you like to change your Cosmos SDK application to a Rollkit rollup?
No problem! You need to replace the Cosmos SDK Go dependency with a
Rollkit-enabled version, which can be found
at the <a href="https://github.com/rollkit/cosmos-sdk" target="_blank" rel="noopener noreferrer"><code>rollkit/cosmos-sdk</code></a> repository.</p><p>Note the <a href="https://github.com/rollkit/cosmos-sdk" target="_blank" rel="noopener noreferrer"><code>rollkit/cosmos-sdk</code></a> repository follows the release branches of
upstream Cosmos SDK, but with the bonus of using Rollkit instead of Tendermint
as the ABCI client.</p><p>And don&#x27;t forget to replace another dependency, <code>tendermint</code>, with
<a href="https://github.com/rollkit/tendermint" target="_blank" rel="noopener noreferrer"><code>rollkit/tendermint</code></a>, which has an enhanced ABCI interface that includes
the methods needed for state fraud proofs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-availability">Data availability<a class="hash-link" href="#data-availability" title="Direct link to heading">‚Äã</a></h3><p><a href="https://github.com/rollkit/rollkit/tree/main/da" target="_blank" rel="noopener noreferrer">Data availability (DA)</a> can be accessed using generic <a href="https://github.com/rollkit/rollkit/blob/main/da/da.go" target="_blank" rel="noopener noreferrer">interfaces</a>. This design allows for seamless integration with any DA layer. New implementations can be plugged in programmatically, without a need to fork Rollkit.</p><p>The <code>DataAvailabilityLayerClient</code> interface includes essential lifecycle methods (<code>Init</code>, <code>Start</code>, <code>Stop</code>) as well as data availability methods (<code>SubmitBlock</code>, <code>CheckBlockAvailability</code>).</p><p>The <code>BlockRetriever</code> interface serves to enable syncing of full nodes from the data availability layer.
It&#x27;s important to keep in mind that there is no direct correlation between the DA layer block height and the rollup height. Each DA layer block may contain an arbitrary number of rollup blocks.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="celestia">Celestia<a class="hash-link" href="#celestia" title="Direct link to heading">‚Äã</a></h4><p>Celestia is an example of a data availability integration implemented for Rollkit.
It&#x27;s using the <a href="https://docs.celestia.org/developers/node-gateway-docs/" target="_blank" rel="noopener noreferrer">Celestia Node Gateway API</a>
via the <a href="https://github.com/celestiaorg/go-cnc" target="_blank" rel="noopener noreferrer"><code>celestiaorg/go-cnc</code></a> package.
To deploy a Rollkit rollup on Celestia you also have to <a href="https://docs.celestia.org/developers/node-tutorial/" target="_blank" rel="noopener noreferrer">run a Celestia light node</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="node-components">Node components<a class="hash-link" href="#node-components" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mempool">Mempool<a class="hash-link" href="#mempool" title="Direct link to heading">‚Äã</a></h3><p>The <a href="https://github.com/rollkit/rollkit/tree/main/mempool" target="_blank" rel="noopener noreferrer">mempool</a> is inspired by the Tendermint mempool. By default, transactions are handled in a First Come, First Served (FCFS) manner. Ordering of transactions can be implemented on the application level; currently this is possible by returning a priority on <code>CheckTx</code>, and once we support ABCI++ it is also possible via <code>PrepareProposal</code> and the <a href="https://docs.cosmos.network/v0.47/building-apps/app-mempool" target="_blank" rel="noopener noreferrer">application mempool</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="block-manager">Block manager<a class="hash-link" href="#block-manager" title="Direct link to heading">‚Äã</a></h3><p>The <a href="https://github.com/rollkit/rollkit/tree/main/block" target="_blank" rel="noopener noreferrer">block manager</a> contains Go routines <code>AggregationLoop</code>, <code>RetrieveLoop</code>, and <code>SyncLoop</code> that communicate through Go channels. These Go routines are ran when a Rollkit node starts up (<code>OnStart</code>). Only the sequencer nodes run <code>AggregationLoop</code> which controls the frequency of block production for a rollup with a timer as per the <code>BlockTime</code> in <code>BlockManager</code>.</p><p>All nodes run <code>SyncLoop</code> which looks for the following operations:</p><ul><li><strong>Receive block headers</strong>: block headers are received through a channel <code>HeaderInCh</code> and Rollkit nodes attempt to verify the block with the corresponding block data.</li><li><strong>Receive block data</strong>: block bodies are received through a channel <code>blockInCh</code> and Rollkit nodes attempt to verify the block.</li><li><strong>Receive state fraud proofs</strong>: state fraud proofs are received through a channel <code>FraudProofInCh</code> and Rollkit nodes attempt to verify them. Note that we plan to make this configurable for full nodes since full nodes also produce state fraud proofs on their own.</li><li>Signal <code>RetrieveLoop</code> with timer as per the <code>DABlockTime</code> in <code>BlockManager</code>.</li></ul><p>All nodes also run <code>RetrieveLoop</code> which is responsible for interacting with the data availability layer. It checks the last updated <code>DAHeight</code> to retrieve a block with timer <code>DABlockTime</code> signaled by <code>SyncLoop</code>. Note that the start height of the DA layer for the rollup, <code>DAStartHeight</code>, is configurable in <code>BlockManager</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rpc">RPC<a class="hash-link" href="#rpc" title="Direct link to heading">‚Äã</a></h3><p>Rollkit&#x27;s <a href="https://github.com/rollkit/rollkit/tree/main/rpc" target="_blank" rel="noopener noreferrer">RPC</a> fully implements the <a href="https://docs.tendermint.com/v0.34/rpc" target="_blank" rel="noopener noreferrer">Tendermint RPC</a> interfaces and APIs for querying:</p><ul><li><strong>Information about the rollup node</strong>: information such as node&#x27;s health, status, and network info.</li><li><strong>The rollup blockchain</strong>: getting information about the rollup blockchain such as blocks and block headers.</li><li><strong>The rollup transactions</strong>: getting transaction information and broadcasting raw transactions, with search capabilities.</li><li><strong>ABCI</strong>: rollup application information.</li></ul><p>The following RPC protocols are currently supported:</p><ul><li>URI over HTTP</li><li>JSON-RPC over HTTP</li><li>JSON-RPC over WebSockets</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="p2p-layer">P2P layer<a class="hash-link" href="#p2p-layer" title="Direct link to heading">‚Äã</a></h3><p>Rollkit&#x27;s <a href="https://github.com/rollkit/rollkit/tree/main/p2p" target="_blank" rel="noopener noreferrer">P2P layer</a> enables
direct communication between rollup nodes.
It&#x27;s used to gossip transactions, headers of newly created blocks, and state fraud proofs.
The P2P layer is implemented using <a href="https://github.com/libp2p" target="_blank" rel="noopener noreferrer">libp2p</a>.</p><p>Rollkit uses <a href="https://curriculum.pl-launchpad.io/curriculum/libp2p/dht/" target="_blank" rel="noopener noreferrer">DHT-based active peer discovery</a>.
Starting a node connects to pre-configured bootstrap peers, and advertises its namespace ID in the DHT.
This solution is flexible, because multiple rollup networks may reuse the same DHT/bootstrap nodes,
but specific rollup network might decide to use dedicated nodes as well.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rollkit-node-types">Rollkit node types<a class="hash-link" href="#rollkit-node-types" title="Direct link to heading">‚Äã</a></h2><p>Rollkit nodes are implemented in the <a href="https://github.com/rollkit/rollkit/tree/main/node" target="_blank" rel="noopener noreferrer"><code>node</code></a> package.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="full-node">Full node<a class="hash-link" href="#full-node" title="Direct link to heading">‚Äã</a></h3><p>Full nodes verify all blocks, and produce fraud proofs for optimistic rollups. Since they fully verify all rollup blocks, they don&#x27;t rely on fraud or validity proofs for security.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="light-node-work-in-progress">Light node (work in progress)<a class="hash-link" href="#light-node-work-in-progress" title="Direct link to heading">‚Äã</a></h3><p>Light nodes are light-weight rollup nodes that authenticate block headers, and can be secured by fraud proofs or validity proofs. They&#x27;re recommended for average users on low-resource devices. Users running light nodes can make trust-minimized queries about the rollup&#x27;s state. Currently, Rollkit light nodes are still under development.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sequencer-node">Sequencer node<a class="hash-link" href="#sequencer-node" title="Direct link to heading">‚Äã</a></h3><p>Rollups can utilize sequencer nodes. Sequencers are block producers for rollups, responsible for aggregating transactions into blocks, and typically executing transactions to produce a state root, used by the rollup&#x27;s light clients.</p><p>Rollkit plans to support multiple different pluggable sequencer schemes:</p><table><thead><tr><th align="center"></th><th align="center">Deploy in one-click</th><th align="center">Faster soft-confirmations than L1</th><th align="center">Control over rollup&#x27;s transaction ordering</th><th align="center">Atomic composability with other rollups</th><th align="center">Censorship resistance</th><th align="center">Implementation Status</th></tr></thead><tbody><tr><td align="center">Centralized sequencer</td><td align="center">Requires spinning up a sequencer</td><td align="center">Yes ‚úÖ</td><td align="center">Yes ‚úÖ</td><td align="center">No ‚ùå</td><td align="center">Eventual ‚è≥*</td><td align="center">‚úÖ Implemented!</td></tr><tr><td align="center">Decentralized sequencer</td><td align="center">Requires spinning up a sequencer set</td><td align="center">Yes ‚úÖ</td><td align="center">Yes ‚úÖ</td><td align="center">No ‚ùå</td><td align="center">Real-time ‚ö°Ô∏è</td><td align="center">Planned</td></tr><tr><td align="center">Shared decentralized sequencer</td><td align="center">Yes ‚úÖ</td><td align="center">Yes ‚úÖ</td><td align="center">No ‚ùå</td><td align="center">Yes ‚úÖ</td><td align="center">Real-time ‚ö°Ô∏è</td><td align="center">Planned</td></tr><tr><td align="center">Pure fork-choice rule</td><td align="center">Yes ‚úÖ</td><td align="center">No ‚ùå</td><td align="center">Maybe üü°</td><td align="center">Maybe üü°</td><td align="center">Eventual ‚è≥</td><td align="center">Planned</td></tr></tbody></table><p>&quot;Pure fork-choice rule&quot; refers to any rollup without privileged sequencers, e.g. nodes defer to the data availability layer for ordering and apply a &quot;first-come-first-serve&quot; fork-choice rule.</p><p>*<!-- --> implementation of this property is in progress.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="state-validity-modes">State validity modes<a class="hash-link" href="#state-validity-modes" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pessimistic-full-nodes-only">Pessimistic (full nodes only)<a class="hash-link" href="#pessimistic-full-nodes-only" title="Direct link to heading">‚Äã</a></h3><p>A pessimistic rollup is a rollup that only supports full nodes that replay all the transactions in the rollup in order to check its validity. Rollkit supports pessimistic rollups by default.</p><p>Pessimistic rollups are similar to how Tether uses Bitcoin as a data availability layer via <a href="https://github.com/OmniLayer/spec/blob/master/OmniSpecification-v0.6.adoc#summary" target="_blank" rel="noopener noreferrer">OmniLayer</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optimistic-fraud-proofs-work-in-progress">Optimistic (fraud proofs) (work in progress)<a class="hash-link" href="#optimistic-fraud-proofs-work-in-progress" title="Direct link to heading">‚Äã</a></h3><p>Rollkit&#x27;s current design consists of a single sequencer that posts blocks to the DA layer, and multiple (optional) full nodes. Sequencers gossip block headers to full nodes and full nodes fetch posted blocks from the DA layer. Full nodes then execute transactions in these blocks to update their state, and gossip block headers over the P2P network to Rollkit light nodes.</p><p>Once state fraud proofs are enabled, when a block contains a fraudulent state transition, Rollkit full nodes can detect it by comparing intermediate state roots (ISRs) between transactions, and generate a state fraud proof that can be gossiped over the P2P network to Rollkit light nodes. These Rollkit light nodes can then use this state fraud proof to verify whether a fraudulent state transition occurred or not by themselves.</p><p>Overall, state fraud proofs will enable trust-minimization between full nodes and light nodes as long as there is at least one honest full node in the system that will generate state fraud proofs.</p><p>Note that Rollkit state fraud proofs are still a work in progress and will require new methods on top of ABCI, specifically, <code>GenerateFraudProof</code>, <code>VerifyFraudProof</code>, and <code>GetAppHash</code>.</p><p>You can find current detailed design and the remaining work needed to push state fraud proofs towards completion in this <a href="https://github.com/rollkit/rollkit/blob/manav/state_fraud_proofs_adr/docs/lazy-adr/adr-009-state-fraud-proofs.md" target="_blank" rel="noopener noreferrer">Architecture Decision Record (ADR)</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="validity-zk-proofs">Validity (ZK proofs)<a class="hash-link" href="#validity-zk-proofs" title="Direct link to heading">‚Äã</a></h3><p>Validity (ZK) rollups are planned, but not currently supported by Rollkit.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rollkit/docs/tree/main/docs/rollkit-stack.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/intro/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/transaction-flow/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transaction flow</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#application-structure" class="table-of-contents__link toc-highlight">Application structure</a><ul><li><a href="#abci-interface" class="table-of-contents__link toc-highlight">ABCI interface</a></li><li><a href="#data-availability" class="table-of-contents__link toc-highlight">Data availability</a></li></ul></li><li><a href="#node-components" class="table-of-contents__link toc-highlight">Node components</a><ul><li><a href="#mempool" class="table-of-contents__link toc-highlight">Mempool</a></li><li><a href="#block-manager" class="table-of-contents__link toc-highlight">Block manager</a></li><li><a href="#rpc" class="table-of-contents__link toc-highlight">RPC</a></li><li><a href="#p2p-layer" class="table-of-contents__link toc-highlight">P2P layer</a></li></ul></li><li><a href="#rollkit-node-types" class="table-of-contents__link toc-highlight">Rollkit node types</a><ul><li><a href="#full-node" class="table-of-contents__link toc-highlight">Full node</a></li><li><a href="#light-node-work-in-progress" class="table-of-contents__link toc-highlight">Light node (work in progress)</a></li><li><a href="#sequencer-node" class="table-of-contents__link toc-highlight">Sequencer node</a></li></ul></li><li><a href="#state-validity-modes" class="table-of-contents__link toc-highlight">State validity modes</a><ul><li><a href="#pessimistic-full-nodes-only" class="table-of-contents__link toc-highlight">Pessimistic (full nodes only)</a></li><li><a href="#optimistic-fraud-proofs-work-in-progress" class="table-of-contents__link toc-highlight">Optimistic (fraud proofs) (work in progress)</a></li><li><a href="#validity-zk-proofs" class="table-of-contents__link toc-highlight">Validity (ZK proofs)</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2023 Rollkit</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5469df33.js"></script>
<script src="/assets/js/main.532514d8.js"></script>
</body>
</html>